<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Vakilaw.Views.TransactionsPage"
             xmlns:vm="clr-namespace:Vakilaw.ViewModels"
             Title="ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§" FlowDirection="RightToLeft">

    <Shell.TitleView>
        <VerticalStackLayout>
            <Grid Padding="10" ColumnDefinitions="auto,auto">
                <!--<Label Text="Ø¨Ø±Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ" Grid.Column="0" Margin="-10,5,0,0" FontFamily="IRANSansWeb" FontSize="14" FontAttributes="Bold"/>-->
                <Label Text="Ù„ÛŒØ³Øª ØªØ±Ø§Ú©Ù†Ø´ Ù‡Ø§" Grid.Column="1" FontFamily="IRANSansWeb" TextColor="Gold" FontSize="16" FontAttributes="Bold" Margin="60,3"/>
            </Grid>
        </VerticalStackLayout>
    </Shell.TitleView>

    <Grid RowDefinitions="Auto, *" Padding="10" BackgroundColor="#0d1b2a">
        <VerticalStackLayout Grid.Row="0" Padding="15" Spacing="15">
            <Entry Placeholder="ðŸ” Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø±Ø§Ø³Ø§Ø³ Ø¹Ù†ÙˆØ§Ù† ..." PlaceholderColor="DarkGray" FontFamily="IRANSansWeb" HorizontalOptions="Fill"
            Text="{Binding SearchText, Mode=TwoWay}" ClearButtonVisibility="WhileEditing"/>

            <!-- Ø³Ø±Ú† Ø¨Ø§Ø²Ù‡ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ -->
            <HorizontalStackLayout Spacing="8">
                <Entry Placeholder="Ø§Ø² ØªØ§Ø±ÛŒØ® (Ù…Ø«Ø§Ù„: 1404/07/01)"
                       PlaceholderColor="DarkGray"
                       FontFamily="IRANSansWeb"
                       Text="{Binding FromDateShamsi, Mode=TwoWay}"
                       WidthRequest="175"/>

                <Entry Placeholder="ØªØ§ ØªØ§Ø±ÛŒØ® (Ù…Ø«Ø§Ù„: 1404/07/05)"
                       PlaceholderColor="DarkGray"
                       FontFamily="IRANSansWeb"
                       Text="{Binding ToDateShamsi, Mode=TwoWay}"
                       WidthRequest="175"/>
            </HorizontalStackLayout>

            <!-- Ø¯Ú©Ù…Ù‡ Ø³Ø±Ú† Ø¨Ø§Ø²Ù‡ -->
            <Button Text="ðŸ” Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ø¨Ø§Ø²Ù‡"
                    Command="{Binding SearchByRangeCommand}"
                    BackgroundColor="#5e548e"
                    TextColor="White"
                    FontFamily="IRANSansWeb"
                    HeightRequest="40"
                    CornerRadius="10"/>

            <!-- Ø¯Ú©Ù…Ù‡ Ø§ÙØ²ÙˆØ¯Ù† ØªØ±Ø§Ú©Ù†Ø´ -->
            <Button Text="âž• Ø§ÙØ²ÙˆØ¯Ù† ØªØ±Ø§Ú©Ù†Ø´" FontAttributes="Bold" FontFamily="IRANSansWeb"
                Command="{Binding ShowAddTransactionPopupCommand}"
                BackgroundColor="#2196F3"
                TextColor="White"
                CornerRadius="10"
                HeightRequest="45"
                HorizontalOptions="Fill"/>

            <Border Stroke="Black" StrokeShape="10" StrokeThickness="3">
                <!-- Ù„ÛŒØ³Øª ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ -->
                <CollectionView ItemsSource="{Binding Transactions}" MaximumHeightRequest="400">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Border Margin="5"
                            Padding="10"
                            StrokeShape="12"                          
                            Stroke="{Binding IsIncome, Converter={StaticResource BoolToColorConverter1}}">
                                <Grid ColumnDefinitions="*,Auto"
                                RowDefinitions="Auto,Auto">

                                    <Label Text="{Binding Title}"
                                   FontAttributes="Bold"
                                   Grid.Row="0" Grid.Column="0"/>

                                    <Label Text="{Binding Amount, StringFormat='{0:N0} ØªÙˆÙ…Ø§Ù†'}" FontFamily="IRANSansWeb"
                                   TextColor="{Binding IsIncome, Converter={StaticResource BoolToColorConverter1}}"
                                   Grid.Row="0" Grid.Column="1"/>

                                    <Label Text="{Binding DateShamsi}"
                                   FontSize="12" FontFamily="IRANSansWeb"
                                   Grid.Row="1" Grid.Column="0"/>

                                    <Button Text="Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªÙˆØ¶ÛŒØ­Ø§Øª" TextColor="White" Grid.Row="1" Grid.Column="1" BackgroundColor="#5e548e" Command="{Binding Source={RelativeSource AncestorType={x:Type vm:TransactionsVM}}, Path=ShowDetailsCommand}" CommandParameter="{Binding Id}" FontSize="12" FontFamily="IRANSansWeb"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Border>
        </VerticalStackLayout>
        
        <!-- ÙÙˆØªØ± Ø«Ø§Ø¨Øª -->
        <VerticalStackLayout Grid.Row="1"
        Padding="10"
        Spacing="0"
        HorizontalOptions="Start"
        VerticalOptions="End">
            <Label FontFamily="IRANSansWeb" FontSize="12" FontAttributes="Bold" TextColor="#48cae4"
            Text="{Binding IncomeAmount, StringFormat='Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ù„: {0:N0} ØªÙˆÙ…Ø§Ù†'}"/>

            <Label FontFamily="IRANSansWeb" FontSize="12" FontAttributes="Bold" TextColor="OrangeRed"
            Text="{Binding ExpenseAmount, StringFormat='Ù‡Ø²ÛŒÙ†Ù‡ Ú©Ù„: {0:N0} ØªÙˆÙ…Ø§Ù†'}"/>

            <Label FontFamily="IRANSansWeb" FontSize="12" FontAttributes="Bold" TextColor="GreenYellow"
            Text="{Binding BalanceAmount, StringFormat='Ø³ÙˆØ¯: {0:N0} ØªÙˆÙ…Ø§Ù†'}"/>

        </VerticalStackLayout>

        <!-- Popup Ù†ÛŒÙ…Ù‡â€ŒØ´ÙØ§Ù -->
        <Grid IsVisible="{Binding IsDetailsVisible}" BackgroundColor="#AA000000">
            <Border Padding="16" StrokeShape="RoundRectangle 12" BackgroundColor="White"
            HorizontalOptions="Center" VerticalOptions="Center"
            WidthRequest="300">
                <Grid RowDefinitions="Auto,*" RowSpacing="20">
                    <!-- ScrollView Ù…ØªÙ† -->
                    <ScrollView Grid.Row="0" VerticalScrollBarVisibility="Always" MaximumHeightRequest="250">
                        <Label Text="{Binding DetailsText}" 
                        TextColor="Black"
                        FontFamily="IRANSansWeb"
                        LineBreakMode="WordWrap"/>
                    </ScrollView>

                    <!-- Ø¯Ú©Ù…Ù‡ Ø¨Ø³ØªÙ† Ù‡Ù…ÛŒØ´Ù‡ Ù¾Ø§ÛŒÛŒÙ† -->
                    <Button Grid.Row="1" Text="Ø¨Ø³ØªÙ†" Command="{Binding CloseDetailsCommand}" 
                    BackgroundColor="Crimson" TextColor="White" FontFamily="IRANSansWeb"/>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</ContentPage>